<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

    <body>
        <%- include('./partials/nav.ejs') %>
            <main class="container">
                <section class="blog-post">
                    <div class="row">
                        <div class="post col-md-10 offset-md-1">
                            <h1>Blog Post Details</h1>
                            <h2>
                                <%= post.title %>
                            </h2>
                            <h4>
                                <%= post.author %>
                            </h4>
                            <p>
                                <%= post.content %>
                            </p>
                        </div>
                </section>
                <section class="add-comment">
                    <form class="commentForm col-md-10 offset-md-1" action="/blog/<%= post.slug %>" method="post">
                        <h3>Add a Comment</h3>
                        <div class="mb-3">
                            <label for="user" class="form-label">Name</label>
                            <input type="text" name="user" class="form-control" id="user"
                                aria-describedby="user" required>
                            <input type="hidden" name="postId" id="postId" value="<%= post.id %>">
                            <input type="hidden" name="id" id="id" value="<%= id + 1 %>">
                        </div>
                        <div class="mb-3"></div>
                        <textarea class="form-control form-control-lg" name="content" placeholder="Write your comment here..." id="content" cols="30"
                            rows="5" required></textarea>
                        </div>
                        <div class="mt-3">
                        <button type="submit" class="btn btn-primary">Submit Comment</button>
                    </div>
                    </form>
                </section>
                <section class="blog-comments col-md-10 offset-md-1">
                    <% comments.forEach(comment=> { %>
                        <p>
                            <%= comment.user %>
                        </p>
                        <p>
                            <%= comment.content %>
                        </p>
                        <a href="" class="deleteComment" data-comId="<%= comment.id %>">Delete</a>
                        <% }); %>
                </section>

                </div>

            </main>


            <%- include('./partials/footer.ejs') %>

            <%- include('./partials/scripts.ejs') %>
            <script>
                const trash = document.querySelector('a.deleteComment');
                console.log(trash.dataset.comId)
                trash.addEventListener('click', (e) => {
                    console.log(trash.dataset.comId)
                    const endpoint = fetch(`http://localhost:9000/comments?id=${trash.dataset.comId}`;
                    fetch(endpoint, {
                        method: 'DELETE'
                    })
                    .then(() => {})
                    .catch(err => console.log(err));
                });

            </script>

    </body>

</html>